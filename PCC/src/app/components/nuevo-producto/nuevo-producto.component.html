<div class="form-card">
  <button class="back-button" (click)="goBack()" type="button">← Regresar</button>
  <h2>Nuevo Producto</h2>
  <form [formGroup]="form" (ngSubmit)="guardar()">
    <fieldset>
      <legend>Datos generales</legend>
      <div class="grid">
        <div class="form-field">
          <label for="nombre">Nombre del material *</label>
          <input type="text" id="nombre" formControlName="nombre" required />
        </div>

        <div class="grid-full form-field">
          <label for="categoria">Categoría *</label>
          <select id="categoria" formControlName="categoria" required>
            <option value="">Selecciona...</option>
            <option>Wire</option>
            <option>Cable</option>
            <option>Shruds</option>
            <option>Head</option>
            <option>Tail</option>
            <option>Box</option>
            <option>Polvora</option>
            <option>Quimicos</option>
            <option>Papel</option>
            <option>Carton</option>
            <option>Otros</option>
          </select>
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Inventario</legend>
      <div class="grid">
        <div class="form-field">
          <label for="stock_actual">Stock actual *</label>
          <input [type]="stockInputType" id="stock_actual" formControlName="stock_actual" [step]="stockStep" required />
        </div>

        <div class="form-field">
          <label for="stock_minimo">Stock mínimo *</label>
          <input [type]="stockInputType" id="stock_minimo" formControlName="stock_minimo" step="0.001" required />
        </div>

        <div class="form-field">
          <label for="unidad">Unidad de medida *</label>
          <select id="unidad" formControlName="unidad" (change)="onUnidadChange($event)" required>
            <option value="">Selecciona...</option>
            <option>PZ</option>
            <option>FT</option>
            <option>LB</option>
            <option>KG</option>
            <option>M</option>
            <option>CM</option>
            <option>ROLLO</option>
            <option>CAJA</option>
            <option>PAQUETE</option>
          </select>
        </div>

        <div class="form-field">
          <label for="precio">Precio unitario *</label>
          <input type="number" id="precio" formControlName="precio" step="0.01" required />
        </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Proveedor</legend>
      <div class="grid">
        <div class="form-field">
          <label for="proveedor">Seleccionar Proveedor *</label>
          <select id="proveedor" formControlName="proveedor" (change)="onProveedorChange($event)" required>
            <option value="">Selecciona...</option>
            <option *ngFor="let prov of proveedores" [value]="prov.id">{{prov.nombre}}</option>
            <option value="nuevo">+ Agregar nuevo proveedor</option>
          </select>
        </div>

        <!-- Formulario de nuevo proveedor (inicialmente oculto) -->
        <div class="nuevo-proveedor-form" *ngIf="mostrarFormProveedor">
          <div class="form-field">
            <label for="nombre_proveedor">Nombre del proveedor *</label>
            <input type="text" id="nombre_proveedor" formControlName="nombre_proveedor" required />
          </div>
          <div class="form-field">
            <label for="telefono">Teléfono *</label>
            <input type="tel" id="telefono" formControlName="telefono" required />
          </div>
          <div class="form-field">
            <label for="email">Email *</label>
            <input type="email" id="email" formControlName="email" required />
          </div>
          <div class="form-field">
            <label for="direccion">Dirección *</label>
            <input type="text" id="direccion" formControlName="direccion" required />
          </div>
          <div class="form-field">
            <label for="rfc">RFC *</label>
            <input type="text" id="rfc" formControlName="rfc" required />
          </div>
        </div>

        <div class="grid-full form-field">
          <label for="notas">Notas adicionales</label>
          <textarea id="notas" formControlName="notas" rows="3"></textarea>
        </div>
      </div>
    </fieldset>

    <div class="actions">
      <button type="reset" class="secondary" (click)="limpiarFormulario()">
        Limpiar
      </button>
      <button type="submit" class="primary" [disabled]="form.invalid">
        Guardar Producto
      </button>
    </div>
  </form>
</div>