<div class="form-card">
  <button class="back-button" (click)="goBack()" type="button">‚Üê Regresar</button>
  <h2>√ìrdenes por Cliente</h2>
  
  <!-- Filtros -->
  <div class="filters-section" *ngIf="!loading && !error">
    <div class="filters-grid">
      <div class="filter-group">
        <label>Cliente</label>
        <input 
          type="text" 
          [(ngModel)]="filters.customer" 
          (ngModelChange)="applyFilters()"
          placeholder="Buscar por nombre..."
          class="filter-input">
      </div>
      
      <div class="filter-group">
        <label>Producto</label>
        <select 
          [(ngModel)]="filters.product" 
          (ngModelChange)="applyFilters()"
          class="filter-select">
          <option value="">Todos</option>
          <option value="PYROBLAST">PYROBLAST</option>
          <option value="J-Tek">J-Tek</option>
          <option value="L√≠nea">L√≠nea</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>M√©todo de Pago</label>
        <select 
          [(ngModel)]="filters.paymentMethod" 
          (ngModelChange)="applyFilters()"
          class="filter-select">
          <option value="">Todos</option>
          <option value="tarjeta">Tarjeta</option>
          <option value="efectivo">Efectivo</option>
          <option value="transferencia">Transferencia</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Estado</label>
        <select 
          [(ngModel)]="filters.estado" 
          (ngModelChange)="applyFilters()"
          class="filter-select">
          <option value="">Todos</option>
          <option value="Pendiente">Pendiente</option>
          <option value="Entregada">Entregada</option>
          <option value="Cancelada">Cancelada</option>
        </select>
      </div>
    </div>
    
    <button class="btn-clear-filters" (click)="clearFilters()" *ngIf="filters.customer || filters.product || filters.paymentMethod || filters.estado">
      üóëÔ∏è Limpiar Filtros
    </button>
  </div>
  
  <div *ngIf="loading" style="text-align: center; padding: 20px;">
    Cargando √≥rdenes...
  </div>
  
  <div *ngIf="error" style="text-align: center; padding: 20px; color: #dc2626;">
    {{ error }}
  </div>
  
  <table class="styled-table" *ngIf="!loading && !error">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Orden</th>
        <th>Producto</th>
        <th>Factura</th>
        <th>Fecha</th>
        <th>M√©todo de Pago</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of filteredOrders">
        <td>{{ order.CustomerName || '-' }}</td>
        <td>{{ order.OrderID ? 'ORD-' + order.OrderID.toString().padStart(3, '0') : '-' }}</td>
        <td>{{ order.Product || '-' }}</td>
        <td>{{ order.Invoice || '-' }}</td>
        <td>{{ order.OrderDate ? (order.OrderDate | date: 'dd/MM/yyyy') : '-' }}</td>
        <td>{{ order.PaymentMethod || '-' }}</td>
        <td>{{ order.estado || '-' }}</td>
        <td>
          <button 
            class="btn-pdf" 
            (click)="downloadPDF(order.OrderID, order.Invoice || 'orden')"
            title="Descargar PDF">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="18" x2="12" y2="12"></line>
              <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
          </button>
          <button 
            class="btn-edit" 
            (click)="editOrder(order)"
            title="Editar orden">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button 
            class="btn-delete" 
            (click)="deleteOrder(order.OrderID, order.Invoice || 'esta orden')"
            title="Dar de baja orden">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </td>
      </tr>
      <tr *ngIf="filteredOrders.length === 0">
        <td colspan="8" style="text-align: center; padding: 20px;">
          {{ orders.length === 0 ? 'No hay √≥rdenes registradas' : 'No se encontraron √≥rdenes con los filtros aplicados' }}
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal de Edici√≥n -->
<div class="modal-overlay" *ngIf="isEditMode" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Editar Orden</h3>
      <button class="btn-close" (click)="closeEditModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>Cliente *</label>
        <select [(ngModel)]="editForm.CustomerID" class="form-control" required>
          <option value="0">Selecciona un cliente...</option>
          <option *ngFor="let customer of customers" [value]="customer.CustomerID">
            {{ customer.CustomerName }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Producto</label>
        <select [(ngModel)]="editForm.Product" class="form-control">
          <option value="">Selecciona un producto...</option>
          <option value="PYROBLAST">PYROBLAST</option>
          <option value="J-Tek">J-Tek</option>
          <option value="L√≠nea">L√≠nea</option>
        </select>
      </div>

      <div class="form-group">
        <label>Factura *</label>
        <input type="text" [(ngModel)]="editForm.Invoice" class="form-control" required>
      </div>

      <div class="form-group">
        <label>Fecha</label>
        <input type="date" [(ngModel)]="editForm.OrderDate" class="form-control">
      </div>

      <div class="form-group">
        <label>M√©todo de Pago</label>
        <select [(ngModel)]="editForm.PaymentMethod" class="form-control">
          <option value="">Selecciona...</option>
          <option value="tarjeta">Tarjeta de cr√©dito/d√©bito</option>
          <option value="efectivo">Efectivo</option>
          <option value="transferencia">Transferencia bancaria</option>
        </select>
      </div>

      <div class="form-group">
        <label>Estado</label>
        <select [(ngModel)]="editForm.estado" class="form-control">
          <option value="Pendiente">Pendiente</option>
          <option value="Entregada">Entregada</option>
          <option value="Cancelada">Cancelada</option>
        </select>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeEditModal()">Cancelar</button>
      <button class="btn-primary" (click)="saveOrder()">Guardar Cambios</button>
    </div>
  </div>
</div>
