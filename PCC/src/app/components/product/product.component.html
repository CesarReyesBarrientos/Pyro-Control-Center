<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario de Productos</title>
</head>
<body>
  <div class="form-card">
    <h2>Inventario de Productos</h2>
    
    <!-- Barra de búsqueda -->
    <div class="search-container">
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Buscar por nombre, SKU, categoría o proveedor..."
          [value]="searchTerm()"
          (input)="onSearchChange($event)"
        />
        @if (searchTerm()) {
          <button class="clear-button" (click)="clearSearch()" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        }
      </div>
      
      @if (isSearching()) {
        <div class="search-status searching">
          <span class="spinner"></span>
          Buscando...
        </div>
      }
      
      @if (searchTerm() && !isSearching()) {
        <div class="search-status results">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          {{ searchResultCount() }} resultado(s) encontrado(s)
        </div>
      }
    </div>

    <table class="styled-table">
      <thead>
        <tr>
          <th>SKU</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>Unidad</th>
          <th>Precio Unitario</th>
          <th>Proveedor</th>
        </tr>
      </thead>
      <tbody>
        @if (items().length === 0) {
          <tr>
            <td colspan="7" class="no-results">
              @if (searchTerm()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <p>No se encontraron productos que coincidan con "{{ searchTerm() }}"</p>
                <button class="btn-clear-search" (click)="clearSearch()">Limpiar búsqueda</button>
              } @else {
                <p>No hay productos en el inventario</p>
              }
            </td>
          </tr>
        } @else {
          <tr *ngFor="let i of items()" [class.low-stock]="isLowStock(i)">
            <td>{{ sku(i.id) }}</td>
            <td>{{ i.nombre || i.producto }}</td>
            <td>{{ i.categoria }}</td>
            <td>{{ i.stock_actual || i.stock }}</td>
            <td>{{ i.unidad_de_medida }}</td>
            <td>{{ i.precio | currency:'MXN':'symbol':'1.0-2' }}</td>
            <td>{{ i.proveedor_nombre }}</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</body>
</html>
