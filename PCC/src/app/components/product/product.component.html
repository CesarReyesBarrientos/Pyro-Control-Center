<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario de Productos</title>
</head>
<body>
  <div class="form-card">
    <h2>Inventario de Productos</h2>
    
    <!-- Barra de búsqueda -->
    <div class="search-container">
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Buscar por nombre, SKU, categoría o proveedor..."
          [value]="searchTerm()"
          (input)="onSearchChange($event)"
        />
        @if (searchTerm()) {
          <button class="clear-button" (click)="clearSearch()" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        }
      </div>
      
      @if (isSearching()) {
        <div class="search-status searching">
          <span class="spinner"></span>
          Buscando...
        </div>
      }
      
      @if (searchTerm() && !isSearching()) {
        <div class="search-status results">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          {{ searchResultCount() }} resultado(s) encontrado(s)
        </div>
      }
    </div>

    <!-- Filtros -->
    <div class="filters-container">
      <div class="filter-group">
        <label for="categoryFilter">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16v5H4zM4 14h16v6H4z"></path>
          </svg>
          Categoría
        </label>
        <select id="categoryFilter" class="filter-select" [value]="selectedCategory()" (change)="onCategoryChange($event)">
          <option value="">Todas las categorías</option>
          <option *ngFor="let cat of categories()" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="supplierFilter">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          Proveedor
        </label>
        <select id="supplierFilter" class="filter-select" [value]="selectedSupplier()" (change)="onSupplierChange($event)">
          <option value="">Todos los proveedores</option>
          <option *ngFor="let sup of suppliers()" [value]="sup">{{ sup }}</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="unitFilter">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          Unidad
        </label>
        <select id="unitFilter" class="filter-select" [value]="selectedUnit()" (change)="onUnitChange($event)">
          <option value="">Todas las unidades</option>
          <option *ngFor="let unit of units()" [value]="unit">{{ unit }}</option>
        </select>
      </div>

      @if (hasActiveFilters()) {
        <button class="clear-filters-btn" (click)="clearAllFilters()" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          Limpiar filtros
        </button>
      }
    </div>

    <table class="styled-table">
      <thead>
        <tr>
          <th>SKU</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Stock</th>
          <th>Unidad</th>
          <th>Precio</th>
          <th>Proveedor</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @if (items().length === 0) {
          <tr>
            <td colspan="7" class="no-results">
              @if (searchTerm()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.35-4.35"></path>
                </svg>
                <p>No se encontraron productos que coincidan con "{{ searchTerm() }}"</p>
                <button class="btn-clear-search" (click)="clearSearch()">Limpiar búsqueda</button>
              } @else {
                <p>No hay productos en el inventario</p>
              }
            </td>
          </tr>
        } @else {
          <tr *ngFor="let i of items()" [class.low-stock]="isLowStock(i)">
            <td>{{ sku(i.id) }}</td>
            <td>{{ i.nombre || i.producto }}</td>
            <td>{{ i.categoria }}</td>
            <td>{{ i.stock_actual || i.stock }}</td>
            <td>{{ i.unidad_de_medida }}</td>
            <td>{{ i.precio | currency:'MXN':'symbol':'1.0-2' }}</td>
            <td>{{ i.proveedor_nombre }}</td>
            <td>
              <button 
                class="btn-delete" 
                (click)="deleteProduct(i.id, i.nombre || i.producto || 'este producto')"
                title="Dar de baja producto">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"></path>
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</body>
</html>
